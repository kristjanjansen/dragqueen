<!DOCTYPE html>
<html>
<head>
    <title></title>
    <style>

        #d1 {
            width: 150px;
            height: 150px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            background-color: blue;
        }

        #d2 {
            width: 150px;
            height: 150px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            background-color: blue;
        }

        .food-box {
            width: 100px;
            height: 100px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            background-color: red;
            position: absolute;
        }

        .container {
            width:1500px;
            height:900px;
            border: 1px solid #000;
        }
    </style>
</head>
<body>

    <div class="container">
        <div class="draggable" id="d1">draggable1</div>
        <div class="draggable" id="d2">draggable2</div>
        <!-- <div class="food-box"></div> -->
    </div>
    <div style="float:right;">
        <div class="message-box"></div>
        <input type="text" name="message">
        <button class="submit-btn">Submit</button>
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.2.3/jquery.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/draggabilly/2.1.0/draggabilly.pkgd.js"></script>
    <script src="/socket.io/socket.io.js"></script>
    <script>

        var socket = io.connect();

        var draggables = $('.draggable');
        var $button = $(".submit-btn");
        var $input = $("input[name=message]");

        draggables.each(function() {
            draggable = $(this).draggabilly({ containment: true }).on('dragMove', function() {
                var draggie = $(this).data('draggabilly');
                // console.log($(this).attr('id'), draggie.position.x, draggie.position.y );
                id = $(this).attr('id')
                socket.emit('move', {
                    id: id, x: draggie.position.x, y: draggie.position.y
                });

            })
        });

        socket.on('move', function (data) {
            $('#' + data.id).css({'left': data.x, 'top': data.y});
        });

        function createFood() {
            // var x = Math.round(Math.random() * (1500-100) / 100);
            // var y = Math.round(Math.random() * (900-100) / 100);
            var x = Math.random() * (0, 1400) + 0;
            var y = Math.random() * (0, 800) + 0;
            $('<div class="food-box"/>').css({ 'left': x, 'top': y }).appendTo(".container");
        }

        createFood();


        $button.on("click", function () {
            var message = $input.val();
            if (message) {
                socket.emit("messageIn", message);
                $input.val("");
            }
        });

        socket.on("messageOut", function (msg) {
            $("<div/>").text(msg).appendTo(".message-box");
        });
/*
        draggables.each(function() {
            draggable = $(this).draggabilly()
            draggie = draggable.data('draggabilly');
            draggies.push(draggie)
        })

        console.log(draggies)

        draggable.on('dragMove', function() {
            console.log('d1', draggies[0].position)
            console.log('d2', draggies[1].position)
        });
*/



       /*
        var draggie = draggable.data('draggabilly');

        draggable.on('dragMove', function() {
            console.log(draggie.position)
        });

        draggable2.on('dragMove2', function() {
            console.log(draggie2.position)
        });
*/

    </script>

</body>
</html>

